---
- hosts: servers
  vars:
    #Logwatch Email
    ubutnu_common_logwatch_email: example@something.edu
    
    #Pagakes to Install
    ubuntu_common_required_packages:
    - ufw
    - fail2ban
    - logwatch
    - unattended-upgrades

    #SSH Settings
    ubuntu_common_ssh_port: 22
    ubuntu_common_jss_port: 8443

  tasks:
    - name: Install required packages
      #loop through the vars above and install all packages
      apt: name={{ ubuntu_common_required_packages }} state=installed

    - name: Setup ufw
      ufw: state=enabled policy=deny
      ufw: rule=allow port={{ ubuntu_common_ssh_port }} proto=tcp
      ufw: rule=allow port={{ ubuntu_common_jss_port }} proto=tcp

      # Setup Logwatch to email daily summary
    - name: Email Logwatch Summay Daily
      lineinfile: 
        path: /etc/cron.daily/00logwatch
        regexp: '^/usr/sbin/logwatch'
        line: '/usr/sbin/logwatch --output mail --mailto {{ ubutnu_common_logwatch_email }} --detail high'
        state: present 
        create: yes

      # Setup unattended security updates/ copues apt_periodic file in directory
    - name: Setup unattended settings on apt
      copy: 
        src: apt_periodic
        dest: /etc/apt/apt.conf.d/10periodic

    - name: Setup unattended security and update channels on apt
      copy: 
        src: apt_periodic50
        dest: /etc/apt/apt.conf.d/50unattended-upgrades